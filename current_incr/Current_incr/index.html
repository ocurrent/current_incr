<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Current_incr (current_incr.Current_incr)</title><link rel="stylesheet" href="../../odoc.css"/><meta charset="utf-8"/><meta name="generator" content="odoc 2.1.1"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body class="odoc"><nav class="odoc-nav"><a href="../index.html">Up</a> â€“ <a href="../index.html">current_incr</a> &#x00BB; Current_incr</nav><header class="odoc-preamble"><h1>Module <code><span>Current_incr</span></code></h1><p>A simple library for incremental computations. Based on &quot;Adaptive Functional Programming&quot; https://www.cs.cmu.edu/~guyb/papers/popl02.pdf</p><p>The basic idea is:</p><ul><li>You run a computation, which produces a result.</li><li>The library records information about the dependencies of the result.</li><li>You can then change one or more inputs and it will rerun just the parts of the computation that are needed to update the result.</li></ul><p>It is similar to Jane Street's &quot;incremental&quot; library, but much smaller and has no external dependencies.</p><p>It is also similar to &quot;react&quot;, but the results do not depend on the behaviour of the garbage collector. In particular, functions stop being called as soon as they are no longer needed, and cannot be called with &quot;impossible&quot; inputs.</p></header><nav class="odoc-toc"><ul><li><a href="#changeable-values">Changeable values</a></li><li><a href="#changeable-computations">Changeable computations</a></li><li><a href="#external-operations">External operations</a></li></ul></nav><div class="odoc-content"><h3 id="changeable-values"><a href="#changeable-values" class="anchor"></a>Changeable values</h3><div class="odoc-spec"><div class="spec type" id="type-t" class="anchored"><a href="#type-t" class="anchor"></a><code><span><span class="keyword">type</span> <span>!'a t</span></span></code></div><div class="spec-doc"><p>An <code>'a t</code> holds a value of type <code>'a</code>, which will update as necessary.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-const" class="anchored"><a href="#val-const" class="anchor"></a><code><span><span class="keyword">val</span> const : <span><span class="type-var">'a</span> <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'a</span> <a href="#type-t">t</a></span></span></code></div><div class="spec-doc"><p><code>const x</code> is the constant value <code>x</code>.</p></div></div><h3 id="changeable-computations"><a href="#changeable-computations" class="anchor"></a>Changeable computations</h3><div class="odoc-spec"><div class="spec type" id="type-cc" class="anchored"><a href="#type-cc" class="anchor"></a><code><span><span class="keyword">type</span> <span>!'a cc</span></span></code></div><div class="spec-doc"><p>An <code>'a cc</code> is a changeable computation that can be run to get a value of type <code>'a</code>. Internally, it is a function that takes a destination variable, reads zero or more other changeable values, and then updates the destination.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-read" class="anchored"><a href="#val-read" class="anchor"></a><code><span><span class="keyword">val</span> read : <span><span><span class="type-var">'a</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span> <span><span>( <span><span class="type-var">'a</span> <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'b</span> <a href="#type-cc">cc</a></span> )</span> <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'b</span> <a href="#type-cc">cc</a></span></span></code></div><div class="spec-doc"><p><code>read x f</code> is a computation that depends on <code>x</code>. <code>f</code> will be called as necessary to ensure that the result stays up-to-date with changes in <code>x</code>.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-write" class="anchored"><a href="#val-write" class="anchor"></a><code><span><span class="keyword">val</span> write : <span>?eq:<span>( <span><span class="type-var">'a</span> <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'a</span> <span class="arrow">&#45;&gt;</span></span> bool )</span> <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'a</span> <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'a</span> <a href="#type-cc">cc</a></span></span></code></div><div class="spec-doc"><p><code>write x</code> is a computation that always returns <code>x</code>.</p><ul class="at-tags"><li class="parameter"><span class="at-tag">parameter</span> <span class="value">eq</span> <p>If <code>eq old_value x = true</code> then the new value is considered equal and no update is done. The default is <code>(==)</code>. It is always safe (though inefficient) to return <code>false</code> here.</p></li></ul></div></div><div class="odoc-spec"><div class="spec value" id="val-of_cc" class="anchored"><a href="#val-of_cc" class="anchor"></a><code><span><span class="keyword">val</span> of_cc : <span><span><span class="type-var">'a</span> <a href="#type-cc">cc</a></span> <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'a</span> <a href="#type-t">t</a></span></span></code></div><div class="spec-doc"><p><code>of_cc x</code> is a changeable value holding the result of evaluating <code>x</code>.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-on_release" class="anchored"><a href="#val-on_release" class="anchor"></a><code><span><span class="keyword">val</span> on_release : <span><span>( <span>unit <span class="arrow">&#45;&gt;</span></span> unit )</span> <span class="arrow">&#45;&gt;</span></span> unit</span></code></div><div class="spec-doc"><p><code>on_release fn</code> calls <code>fn</code> if the current computation has to be redone. This may be useful to release external resources when they are no longer needed. Note that the order in which multiple such functions are called is somewhat unpredictable.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-map" class="anchored"><a href="#val-map" class="anchor"></a><code><span><span class="keyword">val</span> map : <span>?eq:<span>( <span><span class="type-var">'b</span> <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'b</span> <span class="arrow">&#45;&gt;</span></span> bool )</span> <span class="arrow">&#45;&gt;</span></span> <span><span>( <span><span class="type-var">'a</span> <span class="arrow">&#45;&gt;</span></span> <span class="type-var">'b</span> )</span> <span class="arrow">&#45;&gt;</span></span> <span><span><span class="type-var">'a</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'b</span> <a href="#type-t">t</a></span></span></code></div><div class="spec-doc"><p>A convenience function to read a value, apply a function to it, and write the result.</p></div></div><div class="odoc-spec"><div class="spec module" id="module-Separate" class="anchored"><a href="#module-Separate" class="anchor"></a><code><span><span class="keyword">module</span> <a href="Separate/index.html">Separate</a></span><span> (<a href="Separate/index.html#argument-1-Map">Map</a> : <span class="xref-unresolved">Stdlib</span>.Map.S) : <span class="keyword">sig</span> ... <span class="keyword">end</span></span></code></div><div class="spec-doc"><p>Processing each item of a set efficiently.</p></div></div><h3 id="external-operations"><a href="#external-operations" class="anchor"></a>External operations</h3><p>These functions are used to interface between the changeable system and other systems (e.g. Lwt).</p><div class="odoc-spec"><div class="spec type" id="type-var" class="anchored"><a href="#type-var" class="anchor"></a><code><span><span class="keyword">type</span> <span>!'a var</span></span></code></div><div class="spec-doc"><p>A mutable value that can be changed using <code>change</code>. Internally, <code>type 'a var = 'a t</code>, but it's useful to distinguish between values that are inputs to the system and values that only change in response to computations being rerun.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-var" class="anchored"><a href="#val-var" class="anchor"></a><code><span><span class="keyword">val</span> var : <span><span class="type-var">'a</span> <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'a</span> <a href="#type-var">var</a></span></span></code></div><div class="spec-doc"><p><code>var x</code> creates a new variable initially set to <code>x</code>.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-of_var" class="anchored"><a href="#val-of_var" class="anchor"></a><code><span><span class="keyword">val</span> of_var : <span><span><span class="type-var">'a</span> <a href="#type-var">var</a></span> <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'a</span> <a href="#type-t">t</a></span></span></code></div><div class="spec-doc"><p><code>of_var x</code> casts <code>x</code> to <code>'a t</code>.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-change" class="anchored"><a href="#val-change" class="anchor"></a><code><span><span class="keyword">val</span> change : <span>?eq:<span>( <span><span class="type-var">'a</span> <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'a</span> <span class="arrow">&#45;&gt;</span></span> bool )</span> <span class="arrow">&#45;&gt;</span></span> <span><span><span class="type-var">'a</span> <a href="#type-var">var</a></span> <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'a</span> <span class="arrow">&#45;&gt;</span></span> unit</span></code></div><div class="spec-doc"><p><code>change x v</code> sets the current value of <code>x</code> to <code>v</code> and adds anything that depends on it to the rebuild queue. You must call <code>propagate</code> after this to update everything (you can change several things together and then call <code>propagate</code> once). This function can only be used from the top-level, not from within a computation.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-propagate" class="anchored"><a href="#val-propagate" class="anchor"></a><code><span><span class="keyword">val</span> propagate : <span>unit <span class="arrow">&#45;&gt;</span></span> unit</span></code></div><div class="spec-doc"><p>Apply all changes made with <code>change</code>, so that everything is up-to-date.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-observe" class="anchored"><a href="#val-observe" class="anchor"></a><code><span><span class="keyword">val</span> observe : <span><span><span class="type-var">'a</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span> <span class="type-var">'a</span></span></code></div><div class="spec-doc"><p><code>observe t</code> is the current value of <code>t</code>. If <code>change</code> has been used then the value may be stale until <code>propagate</code> is called.</p></div></div></div></body></html>